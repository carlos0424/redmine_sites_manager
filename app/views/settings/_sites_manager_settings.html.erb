<%= stylesheet_link_tag 'sites_manager', plugin: 'redmine_sites_manager' %>
<%= javascript_include_tag 'sites_manager_admin', plugin: 'redmine_sites_manager' %>

<div class="sites-manager-settings">
  <div class="box tabular settings">
    <!-- ConfiguraciÃ³n General -->
    <h3><%= l('plugin_sites_manager.settings.title') %></h3>
    <div class="settings-group">
      <p>
        <label><%= l('plugin_sites_manager.settings.scope') %></label>
        <%= select_tag 'settings[scope]', 
            options_for_select([
              [l('plugin_sites_manager.settings.global'), 'global'],
              [l('plugin_sites_manager.settings.by_project'), 'project']
            ], @settings['scope']),
            class: 'input-large' %>
      </p>
    </div>

    <!-- Campos Personalizados -->
    <h3><%= l('plugin_sites_manager.settings.custom_fields_mapping') %></h3>
    <div class="settings-group custom-fields-mapping">
      <%# Cargar los campos personalizados disponibles en el sistema %>
      <% custom_fields = CustomField.where(type: 'IssueCustomField').map { |cf| [cf.name, cf.id] } %>

      <%# Iterar sobre los campos definidos en el modelo para mapeo %>
      <% ['s_id', 'depto', 'municipio', 'nom_sitio', 'direccion', 'identificador', 'jerarquia_definitiva', 'fijo_variable', 'coordinador', 'campo_adicional_1', 'campo_adicional_2', 'campo_adicional_3', 'campo_adicional_4', 'campo_adicional_5'].each do |field| %>
        <p>
          <label><%= l("plugin_sites_manager.fields.#{field}") %></label>
          <%= select_tag "settings[custom_fields_mapping][#{field}]", 
              options_for_select(custom_fields, @settings.dig('custom_fields_mapping', field)),
              include_blank: true %>
        </p>
      <% end %>
    </div>

    <%= submit_tag l(:button_apply), class: 'button' %>
  </div>
</div>

<style>
  .sites-manager-settings .settings-group {
    margin-bottom: 20px;
  }
  .sites-manager-settings .settings-group p label {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
  }
  .sites-manager-settings .settings-group select {
    width: 100%;
    max-width: 400px;
  }
</style>
